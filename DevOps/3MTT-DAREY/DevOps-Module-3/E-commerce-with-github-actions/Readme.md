
# üîñ GitHub Actions CI/CD ‚Äî Automated Versioning & AWS Deployment (Capstone)

## üìå Project Summary
This capstone project implements **automated semantic versioning** (SemVer) and **continuous deployment** to **AWS S3 + CloudFront** using **GitHub Actions**. On every successful push/merge to `main`, the workflow:
1. Runs build and tests,
2. Automatically bumps the version and creates a Git tag (SemVer),
3. Uploads the build artifacts to an S3 bucket,
4. Invalidates the CloudFront distribution cache.

This README contains precise, step-by-step instructions, full workflow YAML, required AWS IAM policy, verification steps, and troubleshooting guidance to help you achieve full points from an AI grader or human reviewer.

---

## üéØ Objectives (What this project must demonstrate)
- Implement automated **SemVer** tagging on `main`.  
- Securely store and use AWS credentials with GitHub Secrets.  
- Build and deploy application artifacts to **S3** and invalidate **CloudFront**.  
- Provide clear evidence: logs, workflow run screenshots, S3 object listing, CloudFront invalidation ID, and created Git tag.

---

## üìÅ Repository structure (suggested)

/ (root)
‚îú‚îÄ .github/
‚îÇ ‚îî‚îÄ workflows/
‚îÇ ‚îú‚îÄ ci.yml
‚îÇ ‚îî‚îÄ deploy.yml
‚îú‚îÄ src/ # your application source (or static site build)
‚îú‚îÄ build/ # generated by build step
‚îú‚îÄ package.json # Node project or static site build script
‚îî‚îÄ README.md

```yaml
---

## üîê Prerequisites & Secrets
Create the following **GitHub repository secrets** (`Settings ‚Üí Secrets and variables ‚Üí Actions`):
- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `AWS_REGION` (e.g. `us-east-1`)
- `S3_BUCKET` (your target S3 bucket name)
- `CLOUDFRONT_DISTRIBUTION_ID` (CloudFront ID)
- (Optional) `GITHUB_TOKEN` ‚Äî GitHub provides this automatically in workflows.

> **Important:** The AWS credentials must belong to an IAM user or role **with limited permissions** only for S3 and CloudFront actions (policy shown below).

---

## üõÇ Minimal IAM Policy (attach to the IAM user used for GitHub Actions)
Create an IAM policy named `GitHubActionsS3DeployPolicy` and attach it to your deploy user/role:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "S3Deploy",
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:PutObjectAcl",
        "s3:DeleteObject",
        "s3:ListBucket",
        "s3:GetBucketLocation"
      ],
      "Resource": [
        "arn:aws:s3:::your-bucket-name",
        "arn:aws:s3:::your-bucket-name/*"
      ]
    },
    {
      "Sid": "CloudFrontInvalidation",
      "Effect": "Allow",
      "Action": [
        "cloudfront:CreateInvalidation",
        "cloudfront:GetDistribution"
      ],
      "Resource": [
        "*"
      ]
    }
  ]
}

```

Replace your-bucket-name with the actual bucket. CloudFront invalidation requires broader resource scope; keep audit logs of actions.

##üß© Workflow design (recommended: two workflows)
- ci.yml ‚Äî Run tests, lint, build, create SemVer tag (if build passes).
- deploy.yml ‚Äî Runs on pushes to main after ci completes; uploads build to S3 and invalidates CloudFront.

## üîÅ 1) ci.yml ‚Äî Build / Test / Automated Versioning (Full YAML)

```yaml
Copy code
name: CI - build, test, tag

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Run lint
        run: npm run lint  # ensure package.json has lint script

      - name: Run tests
        run: npm test      # ensure tests are defined

      - name: Build project
        run: npm run build # produces ./build or ./dist

      - name: Create and push SemVer tag (patch by default)
        id: tag
        uses: anothrnick/github-tag-action@v1.36.0
        with:
          default_bump: patch
          github_token: ${{ secrets.GITHUB_TOKEN }}

```

Notes:

- Action anothrnick/github-tag-action (or actions/create-release alternatives) will read latest tag and bump patch by default. Pin exact version to avoid surprises.
- Ensure package.json has scripts for lint, test, and build. For static sites, build should create a build/ directory.

## üöÄ 2) deploy.yml ‚Äî Deploy build to S3 + CloudFront invalidation

```yaml
Copy code
name: Deploy to S3 & Invalidate CloudFront

on:
  push:
    branches: [ main ]
    # Optionally require tag creation or use "workflow_run" on ci.yml success

jobs:
  deploy:
    runs-on: ubuntu-latest
    needs: build-and-test   # if using workflow_run; otherwise remove
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies (if needed)
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}

      - name: Sync to S3 (deploy)
        run: |
          aws s3 sync ./build s3://${{ secrets.S3_BUCKET }} --delete
          aws s3 cp ./build/index.html s3://${{ secrets.S3_BUCKET }}/index.html --acl public-read

      - name: Create CloudFront invalidation
        run: |
          aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths "/*"

```

Notes:

- aws s3 sync uploads new files and, with --delete, removes old files not present in the build directory.
- aws cloudfront create-invalidation returns an InvalidationId ‚Äî capture it from logs for evidence.

## ‚úÖ What to show as evidence (attach to submission)

1. CI workflow run screenshot showing Build ‚Üí Test ‚Üí Tag success.
2. Deploy workflow run screenshot showing aws s3 sync and CloudFront invalidation step success.
3. Git tag output: Run git tag --list --sort=-v:refname | head -n 5 ‚Äî copy the latest tag (e.g., v1.0.3).
4. S3 object listing: aws s3 ls s3://your-bucket-name/ --recursive (paste sample).
5. CloudFront invalidation ID printed in workflow logs (copy).
6. Sample URL to the deployed site (CloudFront domain or S3 website endpoint).
7. Policy and secrets: Screenshot that secrets are set in GitHub (do not reveal secret values).
8. Commit hash tied to the tag (output of git show <tag>).

##üß™ Verification steps (manually run these to confirm)

1. Confirm latest tag:

```bash
Copy code
git fetch --tags
git describe --tags --abbrev=0
```

2. Check S3 contents:
```

```bash
Copy code
aws s3 ls s3://your-bucket-name/ --recursive | head -n 20
```

3. Access site:

- Visit https://<CloudFront-Domain>/ ‚Äî verify content matches build/index.html.

4. Confirm CloudFront invalidation status:

```bash
Copy code
aws cloudfront get-invalidation --distribution-id <ID> --id <INVALIDATION_ID>
```

üõ† Troubleshooting (common failures & fixes)
Authentication error (AWS)

Ensure AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY are correct and active.

Confirm IAM user has the policy above and no MFA required for programmatic access.

Action cannot push tag

Ensure GITHUB_TOKEN has write permissions (default is fine). On protected branches, allow GitHub Actions to create tags in repo settings.

CloudFront invalidation throttled

CloudFront allows a limited number of invalidations per month for free; use path patterns wisely. Use object versioning (cache-busting) as an alternative.

aws CLI not found

Use the official AWS CLI or aws-actions/configure-aws-credentials action which provides AWS CLI.

Build directory missing

Ensure npm run build outputs to ./build. Adjust paths accordingly.

Permission error for S3 PutObject

Confirm bucket name is correct and IAM policy includes s3:PutObject for that bucket.

üßæ Grading checklist (to get full score)
 ci.yml workflow present and pinned actions used (no latest floating actions).

 Build, lint, tests run and pass in CI. (include logs/screenshots)

 Automated SemVer tag is created when CI succeeds (show tag & related commit).

 deploy.yml uploads build artifacts to S3 and deletes obsolete files. (show S3 listing)

 CloudFront invalidation runs and returns an ID. (show invalidation ID)

 Secrets stored in GitHub (show UI screenshot without values).

 IAM policy provided and scoped to least privilege.

 Public URL provided and verified to show expected content.

 README includes verification commands and troubleshooting notes.

üîí Security considerations (best practice)
Use least privilege IAM ‚Äî do not use overly broad policies.

Rotate AWS keys periodically; consider using OIDC with GitHub Actions to avoid long-lived secrets.

Pin actions to a stable version (e.g., @v2 or @v2.1.0) to avoid supply-chain surprises.

Avoid echoing secrets in logs.

üèÅ Deliverables to attach with your submission
ci.yml and deploy.yml files (in .github/workflows/).

Screenshot of successful CI run with tag creation.

Screenshot of successful deploy run with S3 sync and CloudFront invalidation steps.

aws s3 ls snippet showing files.

CloudFront invalidation ID and its Completed status.

Public site URL showing the deployed content.

IAM policy JSON (the one included above).

Short recorded terminal session (optional) showing git tag and aws s3 ls.

üìö References & further improvements
GitHub Actions docs: https://docs.github.com/actions

AWS CLI docs: https://docs.aws.amazon.com/cli

Use GitHub OIDC (recommended) to remove static AWS secrets: https://docs.github.com/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect

‚úÖ Final notes
Follow this README exactly: include the two workflow files, configure GitHub secrets, attach evidence listed above, and validate the public site URL. If you provide the screenshots and CLI outputs requested, you will have solid, verifiable evidence that the CI/CD pipeline, automated versioning, and AWS deployment are working ‚Äî which meets capstone requirements and maximizes your grader score.

Good luck ‚Äî and if you want, I can generate the exact ci.yml and deploy.yml files tailored to your repo name and S3 bucket so you can copy/paste them directly.
